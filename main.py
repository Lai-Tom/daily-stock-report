import os
import google.generativeai as genai
from datetime import datetime
import pytz
import time  # å¼•å…¥æ™‚é–“æ¨¡çµ„ï¼Œç”¨æ–¼æ§åˆ¶é€Ÿåº¦

# è¨­å®š API Key
genai.configure(api_key=os.environ["GEMINI_API_KEY"])

# --- ä½¿ç”¨æ€§èƒ½æ›´å¼·çš„ Pro æ¨¡å‹ ---
model = genai.GenerativeModel('gemini-pro')

# å–å¾—å°ç£æ™‚é–“
tw_time = datetime.now(pytz.timezone('Asia/Taipei')).strftime("%Y-%m-%d %H:%M")

# --- æ‚¨çš„é—œæ³¨æ¸…å–® ---
prompts = [
    {
        "title": "ğŸš€ LUNR (Intuitive Machines) å‹•æ…‹",
        "query": "è«‹è©³ç´°åˆ†æç¾è‚¡ä»£ç¢¼ LUNR (Intuitive Machines) çš„æœ€æ–°è‚¡åƒ¹æŠ€è¡“é¢ã€è¿‘æœŸåˆç´„é€²å±•ã€é‡è¦æ–°èä»¥åŠç¤¾ç¾¤è«–å£‡ï¼ˆå¦‚ Reddit, Xï¼‰çš„è¨è«–ç†±åº¦èˆ‡æƒ…ç·’ã€‚"
    },
    {
        "title": "ğŸŒŒ FLY (Firefly Aerospace) è¿½è¹¤",
        "query": "è«‹æ·±å…¥æŒ–æ˜ Firefly Aerospace (FLY) çš„æœ€æ–°å‹•æ…‹ï¼ŒåŒ…å«ä¸Šå¸‚é€²åº¦ã€ä¾›æ‡‰éˆæ¶ˆæ¯ã€åˆä½œå¤¥ä¼´ä»¥åŠä»»ä½•æ½›åœ¨çš„æ”¿åºœåˆç´„æ–°èã€‚"
    },
    {
        "title": "ğŸ’° é»ƒé‡‘èˆ‡å®è§€ç¶“æ¿Ÿ (Golden Window)",
        "query": "è«‹åˆ†æç•¶å‰çš„å®è§€ç¶“æ¿Ÿæ•¸æ“šï¼ˆé€šè†¨ã€åˆ©ç‡ï¼‰ï¼Œä¸¦çµåˆã€Œé‡‘ç©¹ (Golden Window)ã€ç†è«–ï¼Œè§£è®€é»ƒé‡‘åƒ¹æ ¼èµ°å‹¢èˆ‡ç¾åœ‹ä¸‰å¤§æˆ°ç•¥è¨ˆåŠƒï¼ˆé‡‘ç©¹ã€Janusã€Artemisï¼‰çš„é—œè¯æ€§ã€‚"
    },
    {
        "title": "âš›ï¸ æ ¸èƒ½æ¿å¡Šæ·±åº¦æƒæ",
        "query": "è«‹é‡å°ç¾è‚¡æ ¸èƒ½æ¿å¡Šé‡é»å€‹è‚¡ï¼šOKLO, BWXT, SMR, LEU é€²è¡Œç¶œåˆåˆ†æã€‚è«‹æ¯”è¼ƒå®ƒå€‘è¿‘æœŸçš„æ¶ˆæ¯é¢åˆ©å¤šèˆ‡åˆ©ç©ºï¼Œä¸¦è©•ä¼°çŸ­æœŸå…§çš„æŠ•è³‡é¢¨éšªèˆ‡æ©Ÿæœƒã€‚"
    },
    {
        "title": "ğŸ‡¹ğŸ‡¼ å°ç©é›» (2330/TSM) æˆ°ç•¥åˆ†æ",
        "query": "è«‹æ•´ç†å°ç©é›» (2330/TSM) æœ€æ–°çš„æ³•èªªæœƒé—œéµæ•¸æ“šã€é«˜å±¤å°æœªä¾†çš„å±•æœ›è¨€è«–ï¼Œä»¥åŠè¯çˆ¾è¡—èˆ‡å¤–è³‡æ©Ÿæ§‹å°å…¶å¾Œå¸‚çš„æœ€æ–°è©•ç´šèˆ‡ç›®æ¨™åƒ¹èª¿æ•´ã€‚"
    }
]

# --- ç”Ÿæˆ HTML å…§å®¹ ---
html_content = f"""
<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å€‹äººç¾è‚¡æˆ°æƒ…å®¤ ({tw_time})</title>
    <style>
        body {{ font-family: "Microsoft JhengHei", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; line-height: 1.8; max-width: 900px; margin: 0 auto; padding: 20px; background-color: #f0f2f5; color: #1c1e21; }}
        h1 {{ text-align: center; color: #003366; border-bottom: 3px solid #d32f2f; padding-bottom: 15px; margin-bottom: 10px; }}
        .timestamp {{ text-align: center; color: #606770; font-size: 0.9em; margin-bottom: 40px; }}
        .card {{ background: white; padding: 30px; margin-bottom: 25px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); }}
        h2 {{ color: #d32f2f; margin-top: 0; border-left: 5px solid #003366; padding-left: 10px; }}
        strong {{ color: #000; font-weight: 700; background-color: #fff3cd; padding: 0 4px; }}
        li {{ margin-bottom: 8px; }}
        .error {{ color: red; background: #ffe6e6; padding: 10px; border-radius: 5px; }}
    </style>
</head>
<body>
    <h1>ğŸ“ˆ å€‹äººç¾è‚¡æˆ°æƒ…å®¤ (Pro æ·±åº¦ç‰ˆ)</h1>
    <p class="timestamp">æ›´æ–°æ™‚é–“ï¼š{tw_time} (UTC+8)</p>
"""

print("ğŸš€ é–‹å§‹ç”Ÿæˆ Pro ç‰ˆæ·±åº¦å ±å‘Š...")

for index, item in enumerate(prompts):
    print(f"[{index+1}/{len(prompts)}] æ­£åœ¨æ·±åº¦åˆ†æï¼š{item['title']}...")
    try:
        response = model.generate_content(item['query'])
        
        # å°‡ Markdown æ ¼å¼è½‰ç‚º HTML
        text_content = response.text
        text_content = text_content.replace("### ", "<h3>").replace("###", "</h3>")
        text_content = text_content.replace("**", "<strong>").replace("* ", "<li>").replace("\n", "<br>")
        
        html_content += f"""
        <div class="card">
            <h2>{item['title']}</h2>
            <div>{text_content}</div>
        </div>
        """
        print("   âœ… åˆ†æå®Œæˆ")
        
    except Exception as e:
        print(f"   âŒ ç™¼ç”ŸéŒ¯èª¤ï¼š{str(e)}")
        html_content += f"<div class='card'><h2>{item['title']}</h2><p class='error'>åˆ†æå¤±æ•—ï¼ŒåŸå› ï¼š{str(e)}</p></div>"

    # --- å®‰å…¨é˜²è­·ï¼šæ¯è·‘å®Œä¸€å€‹è«‹æ±‚ï¼Œä¼‘æ¯ 35 ç§’ ---
    if index < len(prompts) - 1:
        print("â³ ç‚ºç¢ºä¿ Pro æ¨¡å‹é€£ç·šç©©å®šï¼Œç³»çµ±å†·å» 35 ç§’...")
        time.sleep(35)

html_content += """
    <footer style="text-align: center; margin-top: 50px; padding-top: 20px; border-top: 1px solid #ddd; color: #777; font-size: 0.8em;">
        Generated by Google Gemini 1.5 Pro | Automated via GitHub Actions
    </footer>
</body>
</html>
"""

# å¯«å…¥ index.html
with open("index.html", "w", encoding="utf-8") as f:
    f.write(html_content)

print("ğŸ‰ å ±å‘Šå…¨éƒ¨ç”Ÿæˆå®Œç•¢ï¼")
